{% extends "base.html" %}

{% block pagetitle %}AmmCon Graphs{% endblock pagetitle %}

{%- block head %}
    {{ super() }} {# Render the default head contents #}

{%- endblock head %}

{%- block content %}
    {# put javascript in body so that jquery mobile ajax loads the page correctly -#}
    <!-- amCharts javascript sources -->
    <script src="{{ url_for('static', filename='js/amcharts/amcharts.js') }}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='js/amcharts/plugins/dataloader/dataloader.min.js') }}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='js/amcharts/serial.js') }}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='js/amcharts/themes/black.js') }}" type="text/javascript"></script>
    <script src="{{ url_for('static', filename='js/amcharts/plugins/responsive/responsive.min.js') }}" type="text/javascript"></script>
    <!-- amCharts javascript code -->
    <script type="text/javascript">
        AmCharts.useUTC = false;
        AmCharts.makeChart("chartdiv",
            {
                "type": "serial",
                "categoryField": "datetime",
                // remove dataDateFormat so that dates are shown in user's localtime
                // see https://github.com/amcharts/amcharts3/issues/99
                //"dataDateFormat": "YYYY-MM-DDTHH:NN:SS.QQ",
                "theme": "black",
                "categoryAxis": {
                    "minPeriod": "ss",
                    "parseDates": true,
                    "dateFormats": [
                        {
                            "period": "fff",
                            "format": "JJ:NN:SS"
                        },
                        {
                            "period": "ss",
                            "format": "JJ:NN:SS"
                        },
                        {
                            "period": "hh",
                            "format": "JJ:NN"
                        },
                        {
                            "period": "DD",
                            "format": "MMM DD"
                        },
                        {
                            "period": "WW",
                            "format": "MMM DD"
                        },
                        {
                            "period": "MM",
                            "format": "MMMM"
                        },
                        {
                            "period": "YYYY",
                            "format": "YYYY"
                        },
                        {
                            "period": "mm",
                            "format": "JJ:NN"
                        }
                    ],
                },
                "chartCursor": {
                    "enabled": true,
                    "categoryBalloonDateFormat": "JJ:NN:SS"
                },
                "chartScrollbar": {
                    "enabled": true
                },
                "trendLines": [],
                "graphs": [
                    {
                        "bullet": "round",
                        "connect": false,
                        "id": "AmGraph-1",
                        "title": "Temperature",
                        "valueAxis": "ValueAxis-1",
                        "valueField": "temperature",
                        "type": "smoothedLine"
                    },
                    {
                        "bullet": "square",
                        "id": "AmGraph-2",
                        "title": "Humidity",
                        "valueAxis": "ValueAxis-2",
                        "valueField": "humidity",
                        "type": "smoothedLine",
                    }
                ],
                "guides": [],
                "valueAxes": [
                    {
                        "id": "ValueAxis-1",
                        "unit": "â„ƒ",
                        "minimum": 0,
                        "maximum": 40,
                        //"title": "degC",
                        //"minorTickLength": 1
                    },
                    {
                        "id": "ValueAxis-2",
                        "unit": "%",
                        //"title": "%RH",
                        "position": "right",
                        //"minorTickLength": 1
                    }
                ],
                "allLabels": [],
                "balloon": {},
                "legend": {
                    "enabled": true,
                    "useGraphSettings": true
                },
                "titles": [
                    {
                        "id": "Title-1",
                        "size": 14,
                        "text": "Living Room Temperature"
                    }
                ],
                "dataLoader": {
                    "url": "{{ url_for('graph_temps') }}",
                    "format": "json",
                    "async": true,
                    "showCurtain": true,
                    "postProcess": function(data) {
                        //remove root object 'data' otherwise amcharts won't find the data
                        return data.data;
                    }
                },
                "responsive": {
                    "enabled": true
                }
            }
        );
    </script>

    <div data-role="content">
        <div id="chartdiv" style="width: 100%; height: 300px; background-color: #222222;" ></div>
    </div>
{% endblock content %}

